const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/knowledgeGraphService-DIbazO-f.js","assets/index-CM6rNXwm.js","assets/index-clTyOOP9.css","assets/Relationship-BFqVFYJC.js"])))=>i.map(i=>d[i]);
import{B as y,D as R,E as V,F as M,df as N,aH as G,fW as Q,U as $,C as T,_ as O,N as H,fY as L,fZ as B,cf as X,ay as W,S as Y,dg as b,fo as Z,fn as z}from"./index-CM6rNXwm.js";import{a as J,b as m,r as d,I as tt,m as D,G as v,am as et,P as rt,N as E,U as F,A as nt,E as q,X as j,w as at,v as ot,an as it,ao as A,ap as st}from"./arcadeUtils-9vkxIlvK.js";import{l as ft}from"./portalUtils-CcsAghv1.js";import{f as pt,i as ut}from"./utils-EqwJdR96.js";import{o as lt}from"./utils-D_c_rHu0.js";import{s as ct,m as mt,t as dt,p as ht,c as gt}from"./Relationship-BFqVFYJC.js";import"./TimeOnly-BHcCrk8Q.js";import"./number-mIX6plHU.js";import"./featureConversionUtils-UjQPWqKv.js";import"./OptimizedFeature-DDMKj8Vq.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";let l=class extends M{constructor(t){super(t),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const t=this.geometries.map(o=>o.toJSON()),e=this.geometries[0],n={};return n.outSR=N(this.outSpatialReference),n.inSR=N(e.spatialReference),n.geometries=JSON.stringify({geometryType:G(e),geometries:t}),this.transformation&&(n.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(n.transformForward=this.transformForward),n}};y([R()],l.prototype,"geometries",void 0),y([R({json:{read:{source:"outSR"}}})],l.prototype,"outSpatialReference",void 0),y([R()],l.prototype,"transformation",void 0),y([R()],l.prototype,"transformForward",void 0),l=y([V("esri.rest.support.ProjectParameters")],l);const C=l,yt=Q(C);async function wt(t,e,n){e=yt(e);const o=pt(t),i={...o.query,f:"json",...e.toJSON()},r=e.outSpatialReference,a=G(e.geometries[0]),f=ut(i,n);return $(o.path+"/project",f).then(({data:{geometries:p}})=>lt(p,a,r))}let h=null;async function St(t){const e=H.geometryServiceUrl??"";if(!e){L()||await B();for(const r of t)r.container[r.indexer]=X(r.container[r.indexer],W.WGS84);return}const n=t.map(r=>r.container[r.indexer]),o=new C({geometries:n,outSpatialReference:W.WGS84}),i=await wt(e,o);for(let r=0;r<i.length;r++){const a=t[r];a.container[a.indexer]=i[r]}}async function k(t,e){const n=new Y({portal:t,id:e});return await n.load(),h===null&&(h=await O(()=>import("./knowledgeGraphService-DIbazO-f.js").then(o=>o.k),__vite__mapDeps([0,1,2,3]))),await h.fetchKnowledgeGraph(n.url)}function P(t,e,n,o,i){if(t===null)return null;if(v(t)||q(t))return t;if(j(t)||j(t))return t.toJSDate();if(at(t))return t.toStorageFormat();if(ot(t))return t.toStorageString();if(it(t)){const r={};for(const a of t.keys())r[a]=P(t.field(a),e,n,o,i),r[a]instanceof b&&i.push({container:r,indexer:a});return r}if(F(t)){const r=t.map(a=>P(a,e,n,o,i));for(let a=0;a<r.length;a++)r[a]instanceof b&&i.push({container:r,indexer:a});return r}return A(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&e?Z(t):t:void 0}function Rt(t,e){if(!t)return t;if(t.spatialReference.isWGS84&&e.spatialReference.isWebMercator)return z(t);if(t.spatialReference.equals(e.spatialReference))return t;throw new m(e,d.WrongSpatialReference,null)}function x(t,e){if(!t)return null;const n={};for(const o in t)n[o]=w(t[o],e);return n}function w(t,e){return t===null?null:F(t)?t.map(n=>w(n,e)):t instanceof mt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:x(t.properties,e)}:t instanceof dt?{graphType:"object",properties:x(t.properties,e)}:t instanceof ht?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:x(t.properties,e)}:t instanceof gt?{graphType:"path",path:t.path?t.path.map(n=>w(n,e)):null}:A(t)?Rt(t,e):v(t)||q(t)||st(t)?t:null}function Dt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(e,n){return t.standardFunctionAsync(e,n,(o,i,r)=>{var f,p;if(J(r,2,2,e,n),r[0]===null)throw new m(e,d.PortalRequired,n);if(r[0]instanceof tt){const c=D(r[1]);let g;return g=(f=e.services)!=null&&f.portal?e.services.portal:T.getDefault(),k(ft(r[0],g),c)}if(v(r[0])===!1)throw new m(e,d.InvalidParameter,n);const a=D(r[0]);return k(((p=e.services)==null?void 0:p.portal)??T.getDefault(),a)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(e,n){return t.standardFunctionAsync(e,n,async(o,i,r)=>{var I;J(r,2,4,e,n);const a=r[0];if(!et(a))throw new m(e,d.InvalidParameter,n);const f=r[1];if(!v(f))throw new m(e,d.InvalidParameter,n);h===null&&(h=await O(()=>import("./knowledgeGraphService-DIbazO-f.js").then(s=>s.k),__vite__mapDeps([0,1,2,3])));let p=null;const c=rt(r[2],null);if(!(c instanceof E||c===null))throw new m(e,d.InvalidParameter,n);if(c){let s=[];p=P(c,!0,!1,e,s),s=s.filter(u=>!u.container[u.indexer].spatialReference.isWGS84),s.length>0&&await St(s)}const g=new ct({openCypherQuery:f,bindParameters:p});(((I=a==null?void 0:a.serviceDefinition)==null?void 0:I.currentVersion)??11.3)>11.2&&(g.outputSpatialReference=e.spatialReference);const K=(await h.executeQueryStreaming(a,g)).resultRowsStream.getReader(),_=[];try{for(;;){const{done:s,value:u}=await K.read();if(s)break;if(F(u))for(const S of u)_.push(w(S,e));else{const S=[];for(const U of u)S.push(w(u[U],e));_.push(S)}}}catch(s){throw s}return E.convertJsonToArcade(_,nt(e),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Dt as registerFunctions};
