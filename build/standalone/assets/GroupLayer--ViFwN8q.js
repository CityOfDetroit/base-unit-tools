const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/groupLayerUtils-C3RmpG5d.js","assets/utils-BP2ZwkN4.js","assets/index-DksN7PFj.js","assets/index-clTyOOP9.css","assets/originUtils-D69mHv66.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/jsonContext-D8ceiFlW.js","assets/saveAPIKeyUtils-Cnm3E294.js","assets/saveUtils-81cmUBRU.js","assets/resourceUtils-B7hFCfk5.js","assets/resourceUtils-DCOkVEFN.js"])))=>i.map(i=>d[i]);
import{B as n,D as y,E as v,a7 as g,V as h,fu as _,cE as L,bY as $,cq as I,cu as A,cs as S,ct as O,cv as x,dz as M,bx as u,c$ as V,S as E,aK as P,eJ as p,gw as C,d2 as f,aS as T,gW as R,bz as F,bA as m,_ as H}from"./index-DksN7PFj.js";import{l as w}from"./CollectionFlattener-B4_G_ijA.js";import{t as G}from"./loadAll-CQgWbcPj.js";import{a as j}from"./lazyLayerLoader-CXorIers.js";import{r as B}from"./saveUtils-81cmUBRU.js";import{f as z}from"./writeUtils-DQsURaCy.js";function D(e){return new w({getCollections:()=>[e.tables,e.layers],getChildrenFunction:i=>{const s=[];return"tables"in i&&s.push(i.tables),"layers"in i&&s.push(i.layers),s},itemFilterFunction:i=>{const s=i.parent;return!!s&&"tables"in s&&s.tables.includes(i)}})}function c(e,i,s){let t,r;if(e)for(let o=0,l=e.length;o<l;o++){if(t=e.at(o),(t==null?void 0:t[i])===s)return t;if((t==null?void 0:t.type)==="group"&&(r=c(t.layers,i,s),r))return r}}const k=e=>{let i=class extends e{constructor(...t){super(...t),this.layers=new g;const r=a=>{a.parent&&"remove"in a.parent&&a.parent.remove(a)},o=a=>{a.parent=this,this.layerAdded(a),a.type!=="elevation"&&a.type!=="base-elevation"||h.getLogger(this).error(`Layer 'title:${a.title}, id:${a.id}' of type '${a.type}' is not supported as an operational layer and will therefore be ignored.`)},l=a=>{a.parent=null,this.layerRemoved(a)};this.addHandles([this.layers.on("before-add",a=>{if(a.item===this)return a.preventDefault(),void h.getLogger(this).error("#add()","Cannot add layer to itself.");r(a.item)}),this.layers.on("after-add",a=>o(a.item)),this.layers.on("after-remove",a=>l(a.item))])}destroy(){const t=this.layers.toArray();for(const r of t)r.destroy();this.layers.destroy()}set layers(t){this._set("layers",_(t,this._get("layers")))}add(t,r){const o=this.layers;if(r=o.getNextIndex(r),t instanceof L){const l=t;l.parent===this?this.reorder(l,r):o.add(l,r)}else $(t)?t.then(l=>{this.destroyed||this.add(l,r)}):h.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(t,r){const o=this.layers;let l=o.getNextIndex(r);t.slice().forEach(a=>{a.parent!==this?(o.add(a,l),l+=1):this.reorder(a,l)})}findLayerById(t){return c(this.layers,"id",t)}findLayerByUid(t){return c(this.layers,"uid",t)}remove(t){return this.layers.remove(t)}removeMany(t){return this.layers.removeMany(t)}removeAll(){return this.layers.removeAll()}reorder(t,r){return this.layers.reorder(t,r)}layerAdded(t){}layerRemoved(t){}};return n([y()],i.prototype,"layers",null),i=n([v("esri.support.LayersMixin")],i),i};function b(e,i,s){if(e)for(let t=0,r=e.length;t<r;t++){const o=e.at(t);if(o[i]===s)return o;if((o==null?void 0:o.type)==="group"){const l=b(o.tables,i,s);if(l)return l}}}const N=e=>{let i=class extends e{constructor(...s){super(...s),this.tables=new g,this.addHandles([this.tables.on("after-add",t=>{const r=t.item;r.parent&&r.parent!==this&&"tables"in r.parent&&r.parent.tables.remove(r),r.parent=this,r.type!=="feature"&&h.getLogger(this).error(`Layer 'title:${r.title}, id:${r.id}' of type '${r.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",t=>{t.item.parent=null})])}destroy(){const s=this.tables.toArray();for(const t of s)t.destroy();this.tables.destroy()}set tables(s){this._set("tables",_(s,this._get("tables")))}findTableById(s){return b(this.tables,"id",s)}findTableByUid(s){return b(this.tables,"uid",s)}};return n([y()],i.prototype,"tables",null),i=n([v("esri.support.TablesMixin")],i),i},U=Symbol("WebScene");let d=class extends I(A(S(O(N(k(x(L))))))){constructor(e){super(e),this.allLayers=new w({getCollections:()=>[this.layers],getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=D(this),this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._debouncedSaveOperations=M(async(i,s,t)=>{const{save:r,saveAs:o}=await H(()=>import("./groupLayerUtils-C3RmpG5d.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]));switch(i){case p.SAVE:return r(this,s);case p.SAVE_AS:return o(this,t,s)}})}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([u(()=>{let e=this.parent;for(;e&&"parent"in e&&e.parent;)e=e.parent;return e&&U in e},e=>{const i="prevent-adding-tables";this.removeHandles(i),e&&(this.tables.removeAll(),this.addHandles(F(()=>this.tables,"before-add",s=>{s.preventDefault(),h.getLogger(this).errorOnce("tables","tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.")}),i))},R),u(()=>this.visible,this._onVisibilityChange.bind(this),m)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf("portalItem")===V.USER}_writeLayers(e,i,s,t){const r=[];if(!e)return r;e.forEach(o=>{const l=z(o,t.webmap?t.webmap.getLayerJSONFromResourceInfo(o):null,t);l!=null&&l.layerType&&r.push(l)}),i.layers=r}set portalItem(e){this._set("portalItem",e)}readPortalItem(e,i,s){const{itemId:t,layerType:r}=i;if(r==="GroupLayer"&&t)return new E({id:t,portal:s==null?void 0:s.portal})}writePortalItem(e,i){e!=null&&e.id&&(i.itemId=e.id)}set visibilityMode(e){const i=this._get("visibilityMode")!==e;this._set("visibilityMode",e),i&&this._enforceVisibility(e,this.visible)}async beforeSave(){return B(this)}load(e){const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Group Layer","Scene Service"],layerModuleTypeMap:j},e).catch(s=>{if(P(s),this.sourceIsPortalItem)throw s});return this.addResolvingPromise(i),Promise.resolve(this)}async loadAll(){return G(this,e=>{e(this.layers,this.tables)})}async save(e){return this._debouncedSaveOperations(p.SAVE,e)}async saveAs(e,i){return this._debouncedSaveOperations(p.SAVE_AS,i,e)}layerAdded(e){e.visible&&this.visibilityMode==="exclusive"?this._turnOffOtherLayers(e):this.visibilityMode==="inherited"&&(e.visible=this.visible),this.hasHandles(e.uid)?console.error(`Layer read to Grouplayer: uid=${e.uid}`):this.addHandles(u(()=>e.visible,i=>this._onChildVisibilityChange(e,i),m),e.uid)}layerRemoved(e){this.removeHandles(e.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach(i=>{i!==e&&(i.visible=!1)})}_enforceVisibility(e,i){if(!C(this).initialized)return;const s=this.layers;let t=s.find(r=>r.visible);switch(e){case"exclusive":s.length&&!t&&(t=s.at(0),t.visible=!0),this._turnOffOtherLayers(t);break;case"inherited":s.forEach(r=>{r.visible=i})}}_onVisibilityChange(e){this.visibilityMode==="inherited"&&this.layers.forEach(i=>{i.visible=e})}_onChildVisibilityChange(e,i){switch(this.visibilityMode){case"exclusive":i?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case"inherited":e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(e=>e.visible)}};n([y({readOnly:!0,dependsOn:[]})],d.prototype,"allLayers",void 0),n([y({readOnly:!0})],d.prototype,"allTables",void 0),n([y({json:{read:!0,write:!0}})],d.prototype,"blendMode",void 0),n([y()],d.prototype,"fullExtent",void 0),n([y({readOnly:!0})],d.prototype,"sourceIsPortalItem",null),n([y({json:{read:!1,write:{ignoreOrigin:!0}}})],d.prototype,"layers",void 0),n([f("layers")],d.prototype,"_writeLayers",null),n([y({type:["GroupLayer"]})],d.prototype,"operationalLayerType",void 0),n([y({json:{origins:{"web-map":{read:!1,write:{overridePolicy(e,i,s){return{enabled:(e==null?void 0:e.type)==="Group Layer"&&(s==null?void 0:s.initiator)!==this}}}},"web-scene":{read:!1,write:!1}}}})],d.prototype,"portalItem",null),n([T("web-map","portalItem",["itemId"])],d.prototype,"readPortalItem",null),n([f("web-map","portalItem",{itemId:{type:String}})],d.prototype,"writePortalItem",null),n([y()],d.prototype,"spatialReference",void 0),n([y({json:{read:!1},readOnly:!0,value:"group"})],d.prototype,"type",void 0),n([y({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{type:["independent","exclusive"],write:(e,i,s)=>{e!=="inherited"&&(i[s]=e)}}}}})],d.prototype,"visibilityMode",null),d=n([v("esri.layers.GroupLayer")],d);const Z=d;export{Z as default};
